{# src/Knarf/UserBundle/Resources/views/Security/profil.html.twig #}

{% extends 'KnarfPlatformBundle::layout.html.twig' %}

{% block title %}
    Compte de {{ app.user.username }} - {{ parent() }}
{% endblock %}

{%  block stylesheets %}
    {{ parent() }}
    <link href="{{ asset('bundles/knarfuser/css/profile.css') }}" type="text/css" rel="stylesheet">
{% endblock %}

{% block knarfplatform_body %}
    
    {{ parent() }}
<div class="well">
    <div class="container-fluid">
        <h3>{{ app.user.username }}</h3>
        <p>
        <div class="col-md-6">
            {% if is_granted('ROLE_ADMIN') %}
            Administrateur
            {% endif %}        
        {% if  app.user.avatar is not empty %}
        <div class="avatar">
            <a href="{{ path('edit_avatar') }}" data-toggle="tooltip" data-placement="right" title="Modifier votre avatar">
            <img src="{{vich_uploader_asset(app.user.avatar, 'mediaFile') | imagine_filter('my_thumb_resize') }}" alt="{{ app.user.avatar.nomMedia }}"/>
            </a>
        </div>
        {% else %}
        <a href="{{ path('add_avatar') }}" data-toggle="tooltip" data-placement="right" title="Ajouter votre avatar">
            <img src="{{ asset('/images/icon-person_211874.png') }}" alt="icon person" />
        </a>    
        {% endif %}
        <p>
        <p>
        Vous êtes membre depuis le: {{ app.user.createdAt|date('d/m/Y') }}
        <p>
        Dernière connection le: {{ app.user.lastTimeConnect|date('d/m/Y H:i:s')}}
        </div>
        <div class="col-md-6">
           Votre adresse email: 
           <h4>{{ app.user.email }}</h4>
        <p>
        <p>
        {% if is_granted('ROLE_USER') %}
        <a class="btn btn-primary btn-lg" href="{{ path('change_email') }}">
            Modifier
        </a>
        {% endif %}
        <p>
            <a class="btn btn-warning btn-lg" href="{{ path('change_password') }}">{{ 'menu.changement_password' | trans }}</a>
        </div>
    </div>
</div>

    {% if app.user.adverts %}
        <div class="well" id='adverts-user-profile'>
            <h3>Vos annonces</h3>
            
        <table style="width:100%">                         
            <tr>                          
                <th><h4>Date</h4></th>                            
                <th><h4>Titre</h4></th>
                <th><h4>Rubrique</h4></th>
            </tr>
            {% set count = 0 %}
            {% for entity in app.user.adverts %}                        
            <tr>                           
                {% if entity.published == false %}
                {% set count = count + 1 %}
                <td>{{ entity.date|date('d/m/Y') }}</td>
                <td><a href="{{ path('knarf_platform_view', { 'slug': entity.slug }) }}">
                    {{ entity.title }}</a>
                </td>
                <td>{{ entity.rubrique.intitule }}</td>
                {% endif %}
            </tr>
            {% endfor %}
            <caption>Annonces en attente: {{ count }}</caption>
        </table>
            <p>
            
        <table style="width:100%">                         
            <tr>                          
                <th><h4>Date</h4></th>                            
                <th><h4>Titre</h4></th>
                <th><h4>Rubrique</h4></th>
            </tr>
            {% set countPublished = false %}
            {% for entity in app.user.adverts %}
            <tr>                           
                {% if entity.published == true %}
                {% set countPublished = countPublished + 1 %}
                      
                <td>{{ entity.date|date('d/m/Y') }}</td>
                <td><a href="{{ path('knarf_platform_view', { 'slug': entity.slug }) }}">
                        {{ entity.title }}</a>
                </td>
                <td>{{ entity.rubrique.intitule }}</td>
                {% endif %}
            </tr>
            {% endfor %}
            <caption>Annonces publiées: {{ countPublished }}</caption>

        </table>        
                
        </div>
    {% else %}
    {% endif %}
    <p>
    {% if is_granted('ROLE_USER') %}
        <div class="well">
        <a class="btn btn-primary btn-lg" href="{{ path('knarf_platform_add') }}">
            Ajouter une annonce »
        </a>
        </div>
    {% endif %}
    <p>
    {% if app.user.commentaires is not empty %}
        <div class="well">

            <h4>Vos commentaires</h4>

            <ul class="list-unstyled"> 
            {% for commentaire in app.user.commentaires %}
                <li>
                    {% if commentaire.id is defined %}
                        
                        
                        <a href="{{ commentaire.thread.permalink }}#fos_comment_{{ commentaire.id }}">
                        "{{ commentaire.body }}"
                        </a>


                    {% endif %}
                    <hr>

{#                    {%  if commentaire.commentaire.id is defined %}
                        {{ commentaire.contenu }}
                        sur le <a href="{{ path('knarf_platform_view', {'slug': commentaire.commentaire.advert.slug}) }}#commentaire"> commentaire de:
                        <b>{{ commentaire.commentaire.user.username }}</b></a>

                    {% endif %}#}
                    <hr>
                </li>
            {% endfor %}
        </ul>    
    </div>
    {% endif %}
    <p>
    <p>
        <div class="well">
            <a href="{{ path('knarf_user_delete', {'slug': user.slug}) }}" class="btn btn-danger">
          <i class="glyphicon glyphicon-trash"></i>
          Supprimer votre profil
        </a>
        </div>  
       
{% endblock %}